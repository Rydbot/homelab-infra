name: Renovate

on:
  workflow_dispatch: {}
  schedule:
    # Run during your Renovate schedule window (Australia/Melbourne after 8pm).
    # These times cover both AEST (UTC+10) and AEDT (UTC+11).
    - cron: "30 9 * * *"
    - cron: "30 10 * * *"

concurrency:
  group: renovate
  cancel-in-progress: false

permissions:
  contents: write
  issues: write
  pull-requests: write

jobs:
  renovate:
    runs-on: ubuntu-latest
    env:
      LOG_LEVEL: debug
      RENOVATE_AUTODISCOVER: "true"
      RENOVATE_AUTODISCOVER_FILTER: ${{ github.repository }}
    steps:
      - name: Checkout
        uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5 # v4

      - name: Token source
        env:
          HAS_RENOVATE_TOKEN: ${{ secrets.RENOVATE_TOKEN != '' }}
        run: echo "HAS_RENOVATE_TOKEN=$HAS_RENOVATE_TOKEN (workflow uses GITHUB_TOKEN by default)"

      - name: Run Renovate
        uses: renovatebot/github-action@8b7941943a108b2cc2150730963164aa8baeab8c # v44.2.2
        with:
          # Use GitHub Actions' token by default.
          # If you switch this to a PAT, it MUST have access to read Issues via GraphQL, or Renovate can fail during initRepo().
          token: ${{ secrets.GITHUB_TOKEN }}
          configurationFile: renovate.json
