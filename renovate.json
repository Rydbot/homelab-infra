{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "config:recommended",
    ":dependencyDashboard",
    ":enableVulnerabilityAlerts",
    "docker:pinDigests"
  ],
  "timezone": "Australia/Melbourne",
  "labels": [
    "dependencies"
  ],
  "rebaseWhen": "conflicted",
  "prCreation": "immediate",
  "prHourlyLimit": 0,
  "prConcurrentLimit": 10,
  "branchConcurrentLimit": 10,
  "dependencyDashboardTitle": "Renovate Dependency Dashboard",
  "enabledManagers": [
    "flux",
    "kubernetes"
  ],
  "kubernetes": {
    "managerFilePatterns": [
      "/^apps/.+\\.ya?ml$/",
      "/^infra/.+\\.ya?ml$/",
      "/^clusters/.+\\.ya?ml$/",
      "/^ops/.+\\.ya?ml$/"
    ]
  },
  "ignorePaths": [
    "**/*.b64",
    "age-key.txt",
    "apps/wotlk/**",
    "apps/wow/**",
    "immich_backup_*.sql"
  ],
  "customManagers": [],
  "packageRules": [
    {
      "description": "Auto-merge patch updates (safe defaults).",
      "matchUpdateTypes": [
        "patch"
      ],
      "automerge": true,
      "automergeType": "pr"
    },
    {
      "description": "Group Flux Helm chart updates together.",
      "matchManagers": [
        "flux"
      ],
      "matchDatasources": [
        "helm"
      ],
      "groupName": "flux-helm-charts"
    },
    {
      "description": "Kubernetes image updates (pin digests).",
      "matchManagers": [
        "kubernetes"
      ],
      "matchDatasources": [
        "docker"
      ],
      "pinDigests": true
    },
    {
      "description": "Group Immich image updates together.",
      "matchPaths": [
        "apps/immich/**"
      ],
      "groupName": "immich"
    },
    {
      "description": "Group media stack image updates together.",
      "matchPaths": [
        "apps/jellyfin/**",
        "apps/jellyseerr/**",
        "apps/prowlarr/**",
        "apps/radarr/**",
        "apps/sonarr/**",
        "apps/sabnzbd/**"
      ],
      "groupName": "media-stack"
    },
    {
      "description": "Group homepage-related updates together.",
      "matchPaths": [
        "apps/homepage/**",
        "infra/pod-report/**"
      ],
      "groupName": "homepage"
    },
    {
      "description": "Group tunnel/VPN updates together.",
      "matchPaths": [
        "infra/cloudflared/**",
        "infra/tailscale/**",
        "infra/wireguard/**",
        "ops/wireguard/**"
      ],
      "groupName": "tunnels"
    },
    {
      "description": "Disable WoW-related updates.",
      "matchFileNames": [
        "apps/wotlk/**",
        "apps/wow/**",
        "ops/wotlk-images/**",
        "ops/wow-images/**"
      ],
      "enabled": false
    },
    {
      "description": "Don't auto-merge major updates.",
      "matchUpdateTypes": [
        "major"
      ],
      "automerge": false
    }
  ]
}
